# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a TanStack Start application with React 19, TypeScript, and shadcn/ui components. It uses Vite for bundling, Tailwind CSS v4 for styling, and oRPC for type-safe API communication.

## Development Commands

```bash
# Development server (runs on port 3000)
bun dev

# Build for production
bun build

# Preview production build
bun preview

# Run tests
bun test

# Linting and formatting
bun lint
bun format
bun check  # Format and lint together
```

## Project Architecture

### Routing System

This project uses **TanStack Router** with file-based routing. Routes are defined in `src/routes/` and the route tree is auto-generated in `src/routeTree.gen.ts` (never edit this file manually).

- **Route files**: `src/routes/*.tsx` - Each file exports a `Route` created with `createFileRoute()`
- **Root route**: `src/routes/__root.tsx` - Defines the shell component with `<html>`, `<head>`, and `<body>` tags
- **Router config**: `src/router.tsx` - Creates the router instance with `createRouter()`

### Server Routes (API Endpoints)

TanStack Start allows defining server-side HTTP handlers in route files alongside client components. This is done via the `server` property in `createFileRoute()`.

- **API routes**: Defined in the same `src/routes/` directory
- **Example**: `src/routes/api/rpc.$.ts` - Wildcard route at `/api/rpc/*`
- **Handler methods**: `GET`, `POST`, `PUT`, `DELETE`, `PATCH`, `ANY`
- **Middleware**: Can be added at route level (all methods) or per-method

See `llms/server-router.md` and `llms/middleware.md` for comprehensive documentation on server routes and middleware.

### oRPC Setup (Type-Safe RPC)

This project uses **oRPC** for type-safe client-server communication:

- **Router definition**: `src/server/router/index.ts` - Defines all API procedures with input validation
- **Server handler**: `src/routes/api/rpc.$.ts` - RPC handler endpoint at `/api/rpc/*`
- **OpenAPI spec**: `src/routes/api/openapi.ts` - Auto-generated OpenAPI spec at `/api/openapi`
- **API docs**: `src/routes/api/docs.tsx` - Interactive Scalar API documentation at `/api/docs`
- **Client**: `src/lib/orpc.ts` - Isomorphic client that works on both server and client
- **Example usage**: `src/routes/api-example.tsx` - Demonstrates calling procedures

**Procedure Pattern**:

oRPC procedures use a chainable API:

1. `.input()` - Define input schema (optional)
2. `.output()` - Define output schema (recommended)
3. `.route()` - Define REST/OpenAPI metadata (optional)
4. `.handler()` - Implement the logic

**Example procedure**:

```typescript
import { os } from '@orpc/server'
import { z } from 'zod'

const greet = os
  .input(z.object({ name: z.string().min(1) }))
  .output(z.object({ message: z.string() }))
  .route({ method: 'POST', path: '/greet' })
  .handler(({ input }) => {
    return { message: `Hello, ${input.name}!` }
  })

// Export using os.router()
export const router = os.router({
  greet,
  // Nested routers supported:
  // arena: arenaRouter,
})
```

See `llms/orpc.tanstack-query.md` for TanStack Query integration patterns.

### UI Components (shadcn/ui)

UI components are based on **shadcn/ui** with the following setup:

- **Style**: `base-mira` variant with Tailwind v4
- **Component library**: `@base-ui/react` (headless components)
- **Icons**: `@phosphor-icons/react`
- **Path aliases**: `@/components`, `@/lib`, `@/hooks`
- **Utilities**: `cn()` helper in `src/lib/utils.ts` for className merging

Components are installed in `src/components/ui/` and can be added using the shadcn CLI.

### Path Aliases

The following TypeScript path aliases are configured:

- `@/*` â†’ `./src/*` (enabled via `vite-tsconfig-paths` plugin)

### Styling

- **CSS framework**: Tailwind CSS v4 (via `@tailwindcss/vite`)
- **Global styles**: `src/styles.css`
- **CSS variables**: Enabled for theming
- **Animations**: `tw-animate-css` package available

### Devtools

The following devtools are enabled in development:

- **TanStack Router Devtools**: Shows route tree, active routes, and route params
- **TanStack Query Devtools**: For inspecting React Query cache (when using oRPC with TanStack Query)
- Both are accessible via the bottom-right panel in the UI

## Important Implementation Notes

### Route Generation

- `src/routeTree.gen.ts` is auto-generated by `@tanstack/router-plugin` - never edit manually
- The plugin runs during development and build processes
- Changes to files in `src/routes/` trigger automatic regeneration

### Server vs Client Code

- TanStack Start supports SSR and server-side rendering
- Code in route files can run on both server and client
- Use `createIsomorphicFn()` to create functions that have different implementations for server vs client (see `src/lib/orpc.ts` for example)

### Middleware Pattern

TanStack Start uses a powerful middleware system:

- **Request middleware**: Applies to all server requests (routes, SSR, server functions)
- **Server function middleware**: Applies only to server functions, supports client-side hooks and input validation
- Middleware is composable and can depend on other middleware
- See `llms/middleware.md` for detailed patterns

### Adding Server Functions

When creating new server endpoints, you can either:

1. **Use Server Routes**: Add HTTP handlers to route files via the `server` property
2. **Use oRPC**: Define type-safe procedures in a router and call them from the client

For oRPC implementation, ensure you create the router definition that's currently missing from the template.
